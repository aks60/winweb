<!DOCTYPE html>
<html>
    <head>
        <title>TODO supply a title</title>
        <link rel="stylesheet" type="text/css" media="screen" href="css/jquery-ui-1.13/redmond/jquery-ui.css">          
        <link rel="stylesheet" type="text/css" media="screen" href="css/jqgrid-4.6.3/ui.jqgrid.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/jstree-3.3.12/themes/default/style.min.css" />
        <link rel="stylesheet" type="text/css" media="screen" href="css/menu.css">
        <link rel="stylesheet" type="text/css" media="screen" href="css/html-ui.css">

        <script type="text/javascript" src="jss/jquery-3.6.0/jquery-3.6.0.js"></script>                               
        <script type="text/javascript" src="jss/jquery-ui-1.13/jquery-ui.js"></script> 
        <script type="text/javascript" src="jss/jquery-ui-1.13/i18n/jquery.ui.datepicker-ru.min.js"></script>

        <script type="text/javascript" src="jss/jqgrid-4.6.3/i18n/grid.locale-ru.js"></script>
        <script type="text/javascript" src="jss/jqgrid-4.6.3/jquery.jqGrid.js"></script> 
        <script type="text/javascript" src="jss/jstree-3.3.12/jstree.js"></script>
        <script type="text/javascript" src="frm/utils.js"></script>
        <script type="module" src="frm/builder/wincalc.js"></script>
        <script type="text/javascript">
            var win = {dh_frm: 64, dh_crss: 80, naxl: 12}, dbset = {}, dbrec = {},
                    login = {que_requests: 2}, users = {}, order = {orderID: 16767, wincalcMap: new Map(), prjprodRec: null}, product = {}, kits = {};
        </script>
        <style></style> 

    </head>
    <body>
        <div id="mainmenu"></div>
        <div id="outbody"></div>  
        <div id="dialog-dic"></div> 
        <div id="dialog-mes" title="Сообщение"></div>
        <div id="dialog-list" style="display: none;"><table id="dtable" class="ui-jqgrid-btable"></table></div>
        <script type="module">

            import {
            systreeList, sysprodList, colorList,
                    artiklList, artdetList, furnitureList, furndetList, prjprodList, sysfurnList,
                    sysprofList, syspar1List, paramsList, groupList, orderList, dealerList,
                    kitsList, kitdetList, prjkitList
            } from './frm/builder/dbset.js';

            $("#outbody").load('frm/login.jsp', function () {
                $.when(
                        systreeList(), sysprodList(), colorList(), artiklList(), artdetList(), furnitureList(),
                        furndetList(), prjprodList(), sysfurnList(), sysprofList(), syspar1List(), paramsList(),
                        groupList(), orderList(), dealerList(), kitsList(), kitdetList(), prjkitList()

                        ).done((p1, p2, p3, p4, p5, p6, p7, p8, p9, pA, pB, pC, pD, pE, pF, pG, pH, pI
                        ) => {
                    //загрузка базы данных 
                    //debugger;
                    dbset.systreeList = p1[0].systreeList;
                    dbset.sysprodList = p2[0].sysprodList;
                    dbset.colorList = p3[0].colorList;
                    dbset.artiklList = p4[0].artiklList;
                    dbset.artdetList = p5[0].artdetList;
                    dbset.furnitureList = p6[0].furnitureList;
                    dbset.furndetList = p7[0].furndetList;
                    dbset.prjprodList = p8[0].prjprodList;
                    dbset.sysfurnList = p9[0].sysfurnList;
                    dbset.sysprofList = pA[0].sysprofList;
                    dbset.syspar1List = pB[0].syspar1List;
                    dbset.paramsList = pC[0].paramsList;
                    dbset.groupList = pD[0].groupList;
                    dbset.orderList = pE[0].orderList;
                    dbset.dealerList = pF[0].dealerList;
                    dbset.kitsList = pG[0].kitsList;
                    dbset.kitdetList = pH[0].kitdetList;
                    dbset.prjkitList = pI[0].prjkitList;

                    login.init_login();

                    dbset.sysprofVirt = createVirtualRec(7, {1: -3, 2: 0, 3: 0, 4: -1, 5: -3, 6: -3});
                    dbset.artiklVirt = createVirtualRec(37, {1: -3, 2: 'Авторасчёт', 5: 'Авторасчёт', 14: 80, 15: 4, 35: -3});
                    dbset.artdetVirt = createVirtualRec(37, {1: -3, 14: -3, 15: -3});
                    dbset.colorVirt = createVirtualRec(15, {1: -3, 2: 'Авторасчёт', 4: -3, 14: -3});
                    dbset.sysfurnVirt = createVirtualRec(10, {1: -3, 4: -1, 6: -3, 7: -3, 8: -3, 9: -3});

                }).catch(() => {
                    dialogMes('Ошибка', 'Ошибка загрузки базы данных');
                });
            });

        </script>         
    </body>
</html>

